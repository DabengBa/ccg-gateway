id,issue_title,task_content,acceptance_criteria,project_progress,file_path,prd_link,tech_link,commit_message
T001,新增鉴权与部署相关配置项,"背景：公网部署需要默认安全，必须启用共享 Token 鉴权，并支持容器化环境注入配置。<br>目标：在后端 Settings 中新增鉴权开关/Token/HeaderName 等配置项，并补齐 .env.example。<br>价值：配置集中、可扩展、便于测试与部署（Fail Fast）。","1. Settings 支持读取 CCG_AUTH_ENABLED/CCG_AUTH_TOKEN/CCG_AUTH_HEADER_NAME（默认开启）。<br>2. 当 CCG_AUTH_ENABLED=true 且未提供 CCG_AUTH_TOKEN 时，服务启动失败并给出明确错误。<br>3. .env.example 补齐相关字段并说明用途。",未开始,"backend/app/core/config.py; .env.example",docs/specs/260118-01-docker-deploy-auth/prd.md#4-1-mvp（鉴权/配置）,docs/specs/260118-01-docker-deploy-auth/TECHNICAL_APPROACH.md#ta-4-2-config,feat: add auth env settings and fail-fast, fixes #T001
T002,实现共享 Token 鉴权依赖模块,"背景：需要对 /admin/v1/* 与 /{path:path} 进行统一鉴权，且要求高内聚/低耦合、可单测。<br>目标：新增安全模块，提供 token 提取与校验逻辑，并以 FastAPI dependency 形式暴露。<br>价值：鉴权逻辑可复用、可替换（未来可扩展为多 token/用户体系）。","1. 新增 app/security 下的鉴权模块（如 token_auth.py），并提供 require_gateway_auth 依赖入口。<br>2. 缺少 token 返回 401；token 错误返回 403；错误信息不泄露 token。<br>3. 单元测试覆盖：缺失/错误/正确 token；CCG_AUTH_ENABLED=false 时放行。",未开始,"backend/app/security/token_auth.py; backend/app/api/deps.py; backend/tests/test_token_auth.py",docs/specs/260118-01-docker-deploy-auth/prd.md#4-1-mvp（鉴权）,docs/specs/260118-01-docker-deploy-auth/TECHNICAL_APPROACH.md#ta-4-1-srp,feat: implement header token auth dependency, fixes #T002
T003,为管理 API 与转发入口挂载鉴权依赖,"背景：鉴权必须覆盖 /admin/v1/* 与 /{path:path}，/health 需要免鉴权用于探活。<br>目标：在 router 级别挂载 Depends(require_gateway_auth)，避免全局 middleware 的副作用。<br>价值：边界清晰、影响范围可控，便于后续扩展公共路由。","1. /admin/v1/* 全部受鉴权保护（至少验证 /admin/v1/settings）。<br>2. /{path:path} 全部受鉴权保护。<br>3. /health 仍无需 token 返回 200。<br>4. 集成测试覆盖以上 3 条。",未开始,"backend/app/api/admin.py; backend/app/api/proxy.py; backend/app/main.py; backend/tests/test_auth_integration.py",docs/specs/260118-01-docker-deploy-auth/prd.md#10-2-最终确认,docs/specs/260118-01-docker-deploy-auth/TECHNICAL_APPROACH.md#ta-4-3-coverage,feat: enforce auth on admin and proxy routes, fixes #T003
T004,禁止 X-CCG-Token 透传到上游 Provider,"背景：PRD 明确要求 X-CCG-Token 仅用于客户端->网关鉴权，不得向上游透传；否则会引入安全风险/与上游鉴权冲突。<br>目标：在转发 headers 构造逻辑中剔除该头，提供双保险。<br>价值：隔离网关鉴权与上游鉴权，减少不可预期行为。","1. 转发请求 headers 中不包含 x-ccg-token（大小写不敏感）。<br>2. 单元/集成测试能验证该头不会出现在 forward_headers（可通过 mock httpx client 或检查日志上下文）。",未开始,"backend/app/services/proxy_service.py; backend/tests/test_forward_header_filter.py",docs/specs/260118-01-docker-deploy-auth/prd.md#4-1-mvp（规则：不得透传）,docs/specs/260118-01-docker-deploy-auth/TECHNICAL_APPROACH.md#ta-4-5-no-forward,fix: strip x-ccg-token from upstream headers, fixes #T004
T005,为 debug 日志增加敏感信息脱敏,"背景：当前 debug log 会输出 request/forward headers，可能泄露 Authorization、x-goog-api-key、x-ccg-token 等敏感信息（PRD R2）。<br>目标：新增统一的 headers 脱敏工具函数，并在 debug log 输出前调用。<br>价值：在保留排障能力的同时降低泄露风险，且脱敏逻辑可单测。","1. 新增 redact_headers 工具（纯函数），对 authorization/x-goog-api-key/x-ccg-token/cookie 等做 mask。<br>2. debug_log 开启时，日志中不出现真实 token 或 provider api_key。<br>3. 单元测试覆盖常见 header 脱敏规则。",未开始,"backend/app/security/redaction.py; backend/app/services/proxy_service.py; backend/tests/test_redaction.py",docs/specs/260118-01-docker-deploy-auth/prd.md#8-异常与极端场景（日志泄露）,docs/specs/260118-01-docker-deploy-auth/TECHNICAL_APPROACH.md#ta-4-6-redaction,feat: redact sensitive headers in debug logs, fixes #T005
T006,前端管理 API 请求自动携带 X-CCG-Token（无 UI 版本）,"背景：后端对 /admin/v1/* 启用鉴权后，浏览器端必须带 token 才能正常使用 UI。<br>目标：在 axios 实例中读取 localStorage 中的 token 并附加到请求头（不修改 UI 交互）。<br>价值：最小改动快速闭环，便于后续再做 UI 输入/保存。","1. 若 localStorage 存在 token（如 key=ccg_gateway_token），所有 /admin/v1 请求自动带上 X-CCG-Token。<br>2. 未设置 token 时 UI 显示鉴权失败（沿用现有 toast）。<br>3. 基本手测路径：能通过浏览器控制台设置 token 后正常访问配置页数据。",未开始,"frontend/src/api/instance.ts",docs/specs/260118-01-docker-deploy-auth/prd.md#6-交互与体验（UX）,docs/specs/260118-01-docker-deploy-auth/TECHNICAL_APPROACH.md#ta-5-frontend,feat: attach gateway token header in axios, fixes #T006
T007,（可选）在 UI 提供 token 输入/保存入口,"背景：纯控制台设置 token 不利于可用性，PRD 也提示“是否做 UI 支持”待定。<br>目标：在配置页增加 token 输入框，保存到 localStorage，并可提示当前是否已设置。<br>价值：提升部署后可用性，降低操作门槛。","1. 配置页提供输入框保存 token 到 localStorage（ccg_gateway_token）。<br>2. 保存后刷新页面仍生效。<br>3. 不在界面上明文展示 token（可选用遮罩/显示切换）。",未开始,"frontend/src/views/config/index.vue; frontend/src/views/config/components/CliSettingsForm.vue",docs/specs/260118-01-docker-deploy-auth/prd.md#6-交互与体验（UX）,docs/specs/260118-01-docker-deploy-auth/TECHNICAL_APPROACH.md#ta-5-frontend,feat: add UI for setting gateway token, fixes #T007
T008,为后端提供生产可用 Dockerfile,"背景：PRD 要求提供 Dockerfile，并确保后端绑定 0.0.0.0 可被外部访问。<br>目标：增加 backend 镜像构建与启动方式（uvicorn production mode），并对齐工作目录与 .env/data 路径。<br>价值：标准化部署，减少手工步骤。","1. 新增 backend/Dockerfile 可成功构建镜像。<br>2. 容器启动时 uvicorn 监听 0.0.0.0:${GATEWAY_PORT}。<br>3. 通过环境变量可配置 GATEWAY_PORT/LOG_TO_FILE/CCG_AUTH_*。",未开始,"backend/Dockerfile; backend/pyproject.toml",docs/specs/260118-01-docker-deploy-auth/prd.md#4-1-mvp（Docker/绑定0.0.0.0）,docs/specs/260118-01-docker-deploy-auth/TECHNICAL_APPROACH.md#ta-6-1-backend-dockerfile,feat: add backend dockerfile for web deployment, fixes #T008
T009,为前端+Nginx 提供镜像与反代配置,"背景：PRD 推荐前后端分容器 + Nginx 反代，UI 可访问且可反代 /admin/v1。<br>目标：新增 Nginx 多阶段构建（构建 Vue dist 并由 Nginx 提供静态资源），并配置反代到后端。<br>价值：生产部署更接近通用实践（可扩展 HTTPS/限流）。","1. 新增 nginx 镜像（Dockerfile + nginx.conf），可提供 SPA 静态资源并支持前端路由。<br>2. /admin/v1/* 反代到后端服务（容器网络内）。<br>3. 可选：/health 反代到后端用于探活。",未开始,"nginx/Dockerfile; nginx/nginx.conf; frontend/package.json; frontend/vite.config.ts",docs/specs/260118-01-docker-deploy-auth/prd.md#10-1-可选方案对比,docs/specs/260118-01-docker-deploy-auth/TECHNICAL_APPROACH.md#ta-6-2-web,feat: add nginx+frontend container for web UI, fixes #T009
T010,提供 docker-compose.yml 一键启动（含健康检查与持久化）,"背景：PRD 的核心验收是 docker compose 一键启动、容器健康、数据持久化。<br>目标：新增 docker-compose.yml 编排 backend + nginx，并挂载 data volume、暴露端口、配置 healthcheck。<br>价值：部署者 30 分钟内可完成部署，降低运维成本。","1. 新增 docker-compose.yml，docker compose up -d 后容器正常运行。<br>2. backend 暴露 7788，且 /health 可用。<br>3. data 目录挂载到容器内并能持久化 db/backups/log。<br>4. nginx 暴露 80（可选 443）并能访问 UI。",未开始,"docker-compose.yml",docs/specs/260118-01-docker-deploy-auth/prd.md#4-1-mvp（compose/持久化/health）,docs/specs/260118-01-docker-deploy-auth/TECHNICAL_APPROACH.md#ta-6-3-compose,feat: add docker compose for backend and nginx, fixes #T010
T011,编写部署文档（环境要求/配置/启动/升级/备份恢复）,"背景：PRD 明确要求部署文档放到 ./docs 下，并引用 PRD 结论。<br>目标：输出面向运维的部署说明，包含环境要求、配置项、启动命令、升级/备份/恢复步骤与安全建议。<br>价值：让用户可按文档自助部署并排障。","1. 文档包含：环境要求、必填配置（token 等）、启动命令、升级步骤、备份/恢复步骤。<br>2. 提供至少一套 curl 验收命令（对应 PRD 第 12 节）。<br>3. 明确安全建议：不建议直暴露 7788、配合防火墙/限流、token 轮换。",未开始,"docs/specs/260118-01-docker-deploy-auth/DEPLOYMENT.md",docs/specs/260118-01-docker-deploy-auth/prd.md#4-1-mvp（部署文档）,docs/specs/260118-01-docker-deploy-auth/TECHNICAL_APPROACH.md#ta-8-release,docs: add docker deployment guide, fixes #T011
T012,补齐部署级冒烟测试清单（手动/CI 可复用）,"背景：PRD 给了验收用例，但需要落到可重复执行的检查清单，便于发版与回归。<br>目标：整理冒烟测试步骤（包含带/不带 token 的访问、持久化验证），并尽量可脚本化。<br>价值：提升质量与可追溯性，降低回归成本。","1. 提供一份冒烟测试清单（可放在 docs 或 scripts）。<br>2. 覆盖：/health、/admin/v1/* 鉴权、/{path:path} 鉴权、data 持久化。",未开始,"docs/specs/260118-01-docker-deploy-auth/SMOKE_TEST.md",docs/specs/260118-01-docker-deploy-auth/prd.md#12-验收与完成标准,docs/specs/260118-01-docker-deploy-auth/TECHNICAL_APPROACH.md#ta-7-3-smoke,docs: add smoke test checklist for deploy, fixes #T012
